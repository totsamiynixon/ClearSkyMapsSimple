pr:
  autoCancel: true
  branches:
    include:
    - master

variables:
    SQLSERVER__SA_PASSWORD: Not Important
    ASPNETCORE_ENVIRONMENT: Not Important
    APP_Settings__Version: Not Important
    APP_Settings__ConnectionString: Not Important
    APP_Settings__FirebaseCloudMessaging__ServerKey: Not Important
    APP_Settings__FirebaseCloudMessaging__MessagingSenderId: Not Important
    APP_Settings__ServerUrl: Not Important
    APP_Emulation__ConnectionString: Not Important
    APP_Emulation__Enabled: Not Important
    APP_Admin__JWT__SecretKey: Not Important
    APP_Admin__JWT__Issuer: Not Important
    APP_Admin__JWT__Audience: Not Important
    APP_PWA_Yandex__MapsJavaScriptAPIKey: Not Important
pool:
  vmImage: 'ubuntu-latest'

steps:
- task: DockerCompose@0
  displayName: Build
  inputs:
    containerregistrytype: 'Azure Container Registry'
    dockerComposeFile: './deploy/docker/docker-compose.yml'
    additionalDockerComposeFiles: 'docker-compose.override.yml'
    action: 'Build services'

- task: DockerCompose@0
  displayName: Unit Tests
  inputs:
    containerregistrytype: 'Azure Container Registry'
    dockerComposeFile: './deploy/docker/docker-compose.tests.yml'
    additionalDockerComposeFiles: 'docker-compose.tests.override.yml'
    action: 'Run a specific service'
    serviceName: 'web-unit-tests'
- task: DockerCompose@0
  displayName: Smoke Tests
  inputs:
    containerregistrytype: 'Azure Container Registry'
    dockerComposeFile: './deploy/docker/docker-compose.tests.yml'
    additionalDockerComposeFiles: 'docker-compose.tests.override.yml'
    action: 'Run a specific service'
    serviceName: 'web-smoke-tests'